# causal-inference
# Emergency Department Visits for Obese vs. Non-Obese Patients: A Causal Analysis 

_The following is a brief analytical sample project I performed for a health tech start-up focusing on treatment and care coordination for managing obesity. This firm provided a broad topic for me to explore: “How frequently do people with obesity go to the emergency department versus those who are not obese?” Given the firm's interest in an intervention that addresses obesity itself to improve health outcomes (and not the other comorbid health complications), with the firm’s approval, I chose to 
formalize the original prompt into a more insightful research question: “What are the causal ef ects of being obese on emergency room visits?” The firm required that I exclusively use the open-source Centers for Medicare and Medicaid Services (CMS) 2008-2010 Data Entrepreneurs Synthetic Public Use File 
(DE-SynPUF) to complete the project (more on this data set below). The R programming language was used for statistical analysis._

### Problem Statement
Identify the relationship and elucidate potential causal effects of having obesity on emergency department visits.

### About the Data
Data were sourced from the Centers for Medicare and Medicaid Services (CMS) 2008-2010 Data Entrepreneurs Synthetic Public Use File (DE-SynPUF). The data contained synthetic claims from five file categories: Beneficiary Summary, Inpatient Claims, Outpatient Claims, Carrier Claims, and Prescription Drug Events. These files included key demographic, clinical, and financial data used to inform this analysis. With computational efficiency in mind, CMS randomly split the data into 20 samples, each sample containing claims data from all three years. In the present analysis, I utilized data from 7 of the 20 random samples in order to maximize power for detecting causal effects.

### Data Wrangling 
The primary goal of data wrangling was to create a dataset that would 1) clearly and accurately define those in our treatment (obese) versus control groups (non-obese), 2) indicate our outcome (which patient claims were an emergency room (ER) visit versus non-ER visits), and 3) capture relevant clinical, demographic, and financial data that would allow us to isolate the causal relationship between obesity and ER visits specifically. See Appendix 1 for data wrangling visualization and see Appendix 3 for all factors included in the models. 
Obesity has been historically undercoded in claims data, which presented a key challenge in defining the obese and non-obese target cohorts. However, the literature exploring obesity coding in ICD-9 codes suggests that while claims data have been subject to low sensitivity (meaning obesity diagnoses are often missing in claims data), positive predictive value (PPV) for those with BMI-codes was >70% (Ammann et al., 2012). In other words, when an ICD-9 BMI code was present, it was generally accurate. Given this and the amount of data available in DE-SynPUF, I removed all patients that did not have a ICD-9 BMI code available (codes beginning with “V85” or for general obesity codes beginning with “278”). Then, to define the target cohorts, I followed medical conventions: an individual was considered obese if they had BMI ≥ 30. Further, for the purposes of this study, I grouped all underweight, normal weight, and overweight individuals (BMI < 30) into one non-obese category. 
Next, to define the outcome variable (emergency room visit), I used a research convention for claims data whereby I referenced specific Health Care Common Procedure Coding System (HCPCS) revenue codes corresponding with the emergency room (Venkatesh et al., 2017). The inpatient claims dataset was missing all data associated with HCPCS codes; thus, emergency department visits could not be defined by this method. Therefore, I proceeded with claims exclusively from the Carrier and Outpatient claims files. 
After using the Carrier and Outpatient claims files to identify patients with BMI, our sample contained 28,215 unique patients. Prior to beginning the causal inference analysis, I removed an additional 3,339 patients that had missing/low-quality data in key fields (e.g., county code = “unknown”). Lastly, I addressed the class imbalance between our treatment and control groups (n obese = 14,003; n non-obese = 10,853) by random under-sampling of the obese group. Our final data then consisted of n obese = 10,853; n non-obese = 10,853. 

### Methods
I used two methods to assess the causal relationships and average treatment effects (ATE) of obesity on ER visits: 1) a logistic regression model adjusted with propensity score weights, specifically the inverse probability of treatment weights (IPTW), and 2) a causal Least Absolute Shrinkage and Selection Operator (LASSO) model. Although each model approaches treatment estimation similarly, using both jointly afforded an opportunity to validate findings. Further, the causal LASSO simultaneously performed feature selection. Propensity scores were calculated by estimating a logistic regression of our treatment variable (obesity) on our other variables of interest. Using propensity scores approximated a randomized control trial by controlling for one’s likelihood of being assigned to treatment based on the other observed variables (e.g., kidney disease). I specifically used Inverse Probability of Treatment Weights (IPTW), a variant of propensity score balancing. For those in the treatment group, IPTW = 1/propensity score and for the control IPTW = 1/(1 - propensity score).

### Results
The logistic regression with IPTW and the causal LASSO provided similar treatment effects of being obese on ER visits (see Appendices 2 and 3 for full results). Our casual LASSO retained only 7 out of the 30 original demographic, clinical, and financial variables in our model, indicating that the majority of our variables had insignificant effects on ER visits. As for the causal LASSO, after accounting for the confounded portion of obesity that was attributed to our other variables (“dhat” in Appendix 3), results showed that being obese resulted in a 15.7% (beta = 0.1456) increase in the relative risk of having an ER visit, holding all else constant. Similarly, in our logistic regression model with IPTW, being obese resulted in a 24.2% (beta = 0.2166; p < .001) increase in the relative risk of an ER visit, again holding all other factors constant. Both findings were statistically significant. However, practically speaking, a 24.2% increase represents the difference between a 2.43% risk of ER visits for non-obese patients and 3.02% risk for obese patients. To assess whether this difference is practically meaningful, further work should examine the costs associated with this 0.59 percentage point increase in the number of ER visits. 

### Sumamry
The logistic regression with IPTW and casual LASSO models revealed a significant effect of being obese on ER visits, even after controlling for already highly predictive demographic, financial, and clinical factors. This suggests that targeting obesity alone may be a meaningful intervention for minimizing ER visits. However, the in-sample pseudo-R squared values for our causal LASSO and logistic regression models were quite low, meaning there remains much variance in ER visits not explained by obesity and the relevant factors. Thus, there still likely exists unobserved confounds and important factors that affect either being obese or visiting the ER. For example, patient income was not included here yet very likely predicts whether one can visit the ER or their access to healthcare resources. Moreover, this analysis is limited due to the restriction of our patient cohort to individuals with Medicare (average age of 75 years), thus results may not generalize to the rest of the population. 







